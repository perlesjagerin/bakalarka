@startuml
skinparam backgroundColor #FEFEFE
skinparam handwritten false
skinparam defaultFontSize 12

title Stavový diagram rezervace

state PENDING {
  PENDING : Rezervace vytvořena
  PENDING : Čeká na dokončení platby
}

state PAID {
  PAID : Rezervace zaplacena
  PAID : Vstupenka aktivní
}

state CANCELLED {
  CANCELLED : Rezervace zrušena
  CANCELLED : Bez refundace
}

state REFUNDED {
  REFUNDED : Rezervace zrušena
  REFUNDED : Peníze vráceny
}

[*] --> PENDING : Vytvoření rezervace

PENDING --> PAID : Úspěšná platba\n(Stripe webhook)
PENDING --> CANCELLED : Uživatel zruší\n(před platbou)
PENDING --> CANCELLED : Timeout platby

PAID --> REFUNDED : Refundace\n(reklamace schválena)
PAID --> REFUNDED : Zrušení rezervace\n(uživatelem)
PAID --> REFUNDED : Zrušení akce\n(organizátorem)

CANCELLED --> [*]
REFUNDED --> [*]
PAID --> [*] : Akce proběhla

note right of PENDING
  Placené akce: ticketPrice > 0
  - Stav PENDING do dokončení platby
  
  Akce zdarma: ticketPrice = 0
  - Okamžitě stav PAID
end note

note right of REFUNDED
  Proces refundace:
  1. Stripe refund (pro placené)
  2. Update payment -> REFUNDED
  3. Update reservation -> REFUNDED
  4. Increment availableTickets
  5. Email notifikace
end note

@enduml
